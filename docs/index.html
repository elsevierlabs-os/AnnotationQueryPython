

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>AnnotationQueryPython &mdash; AnnotationQueryPython 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API" href="api.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> AnnotationQueryPython
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">AnnotationQueryPython</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#">Docs</a> &raquo;</li>
        
      <li>AnnotationQueryPython</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="annotationquerypython">
<h1>AnnotationQueryPython<a class="headerlink" href="#annotationquerypython" title="Permalink to this headline">¶</a></h1>
<p>AnnotationQueryPython provides a suite of composable functions to query annotations stored as a parquet file. This implementation is the python version for the scala implementation of AnnotationQuery. While the annotations will typically be generated by popular text analytic tools such as Stanford Core or Genia, the only requirement is the annotations adhere to the AQAnnotation structure (a dataframe with a specific schema). The underlying implementation leverages Dataframes and Spark(SQL). The scala implementation provides better performance over the python implementation. This is a result of the need to use UDFs in the python implementation. Unfortunately, the vectorized UDFs don’t support the map type. Once this happens, the code will be updated to leverage these performance improvements.</p>
<div class="toctree-wrapper compound">
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>
</div>
<div class="section" id="remarks-on-catannotation-and-aqannotation">
<h2>Remarks on CATAnnotation and AQAnnotation<a class="headerlink" href="#remarks-on-catannotation-and-aqannotation" title="Permalink to this headline">¶</a></h2>
<p>While it might seem odd that there are two different types of Annotations, this was purposely done. CATAnnotation is the archive format for the annotations and AQAnnotation is the runtime format that is used by AnnotationQuery. The decision to use two separate classes was to insulate the AnnotationQuery implementation from the archive format providing flexibility for future optimizations. The AQAnnotation record should never be archived (only the CATAnnotation records.</p>
<p>To use AnnotationQuery, the annotations need to be in a parquet file with the following record structure. We refer to this as a CATAnnotation or CATSchema. The other field provides the option of specifying name-value pair attributes for the annotation. For example, if the annotation and 2 attributes (color=red and size=xl), the other field would have the value color=red&amp;size=xl.</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="nt">docId</span><span class="o">:</span> <span class="nt">String</span><span class="o">,</span>                 <span class="o">//</span> <span class="nt">Document</span> <span class="nt">Id</span> <span class="o">(</span><span class="nt">PII</span><span class="o">)</span>
<span class="nt">annotSet</span><span class="o">:</span> <span class="nt">String</span><span class="o">,</span>              <span class="o">//</span> <span class="nt">Annotation</span> <span class="nt">set</span> <span class="o">(</span><span class="nt">such</span> <span class="nt">as</span> <span class="nt">scnlp</span><span class="o">,</span> <span class="nt">ge</span><span class="o">)</span>
<span class="nt">annotType</span><span class="o">:</span> <span class="nt">String</span><span class="o">,</span>             <span class="o">//</span> <span class="nt">Annotation</span> <span class="nt">type</span> <span class="o">(</span><span class="nt">such</span> <span class="nt">as</span> <span class="nt">text</span><span class="o">,</span> <span class="nt">sentence</span><span class="o">)</span>
<span class="nt">startOffset</span><span class="o">:</span> <span class="nt">Long</span><span class="o">,</span>             <span class="o">//</span> <span class="nt">Starting</span> <span class="nt">offset</span> <span class="nt">for</span> <span class="nt">the</span> <span class="nt">annotation</span>
<span class="nt">endOffset</span><span class="o">:</span> <span class="nt">Long</span><span class="o">,</span>               <span class="o">//</span> <span class="nt">Ending</span> <span class="nt">offset</span> <span class="nt">for</span> <span class="nt">the</span> <span class="nt">annotation</span>
<span class="nt">annotId</span><span class="o">:</span> <span class="nt">Long</span><span class="o">,</span>                 <span class="o">//</span> <span class="nt">Annotation</span> <span class="nt">Id</span>
<span class="nt">other</span><span class="o">:</span> <span class="nt">Option</span><span class="o">[</span><span class="nt">String</span><span class="o">]</span> <span class="o">=</span> <span class="nt">None</span><span class="o">)</span>  <span class="o">//</span> <span class="nt">Contains</span> <span class="nt">any</span> <span class="nt">attributes</span>  <span class="o">(</span><span class="nt">name-value</span> <span class="nt">pairs</span> <span class="nt">ampersand</span> <span class="nt">delimited</span><span class="o">)</span>
</pre></div>
</div>
<p>At runtime, AnnotationQuery uses the following record structure (we refer to this as a AQAnnotation or AQSchema). A utility function is provided to transform a CATAnnotation record into a AQAnnotation record. The name-value pairs defined in the other column (of CATAnnotation) will be converted to a Map with the name-value pairs.</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="nt">docId</span><span class="o">:</span> <span class="nt">String</span><span class="o">,</span>                                  <span class="o">//</span> <span class="nt">Document</span> <span class="nt">Id</span> <span class="o">(</span><span class="nt">PII</span><span class="o">)</span>
<span class="nt">annotSet</span><span class="o">:</span> <span class="nt">String</span><span class="o">,</span>                               <span class="o">//</span> <span class="nt">Annotation</span> <span class="nt">set</span> <span class="o">(</span><span class="nt">such</span> <span class="nt">as</span> <span class="nt">scnlp</span><span class="o">,</span> <span class="nt">ge</span><span class="o">)</span>
<span class="nt">annotType</span><span class="o">:</span> <span class="nt">String</span><span class="o">,</span>                              <span class="o">//</span> <span class="nt">Annotation</span> <span class="nt">type</span> <span class="o">(</span><span class="nt">such</span> <span class="nt">as</span> <span class="nt">text</span><span class="o">,</span> <span class="nt">sentence</span><span class="o">)</span>
<span class="nt">startOffset</span><span class="o">:</span> <span class="nt">Long</span><span class="o">,</span>                              <span class="o">//</span> <span class="nt">Starting</span> <span class="nt">offset</span> <span class="nt">for</span> <span class="nt">the</span> <span class="nt">annotation</span>
<span class="nt">endOffset</span><span class="o">:</span> <span class="nt">Long</span><span class="o">,</span>                                <span class="o">//</span> <span class="nt">Ending</span> <span class="nt">offset</span> <span class="nt">for</span> <span class="nt">the</span> <span class="nt">annotation</span>
<span class="nt">annotId</span><span class="o">:</span> <span class="nt">Long</span><span class="o">,</span>                                  <span class="o">//</span> <span class="nt">Annotation</span> <span class="nt">Id</span>
<span class="nt">properties</span><span class="o">:</span> <span class="nt">Option</span><span class="o">[</span><span class="nt">scala</span><span class="p">.</span><span class="nc">collection</span><span class="p">.</span><span class="nc">Map</span><span class="o">[</span><span class="nt">String</span><span class="o">,</span><span class="nt">String</span><span class="o">]]</span> <span class="o">=</span> <span class="nt">None</span><span class="o">)</span>  <span class="o">//</span> <span class="nt">Properties</span>
</pre></div>
</div>
<p>We realize that you can’t have a Dataframe[AQAnnotation] like you can with scala/java Dataset[AQnnotation]. All you can really have is a Dataset[Row]. With that said, whenever we reference in this document a Dataframe[AQAnnotation], what we are trying to convey is that it is a Dataframe with the fields defined in AQAnnotation schema described above.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Elsevier Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>